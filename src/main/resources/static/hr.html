<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HR Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="script.js"></script>
</head>
<body>
  <header>
    <h1>HR Dashboard</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <main>
    <section class="form-container">
      <h2>Post a Job</h2>
      <form id="jobForm">
        <input type="text" id="title" placeholder="Job Title" required>
        <textarea id="description" placeholder="Job Description" required></textarea>
        <input type="text" id="skills" placeholder="Skills (comma separated)" required>
        <button type="submit">Post Job</button>
      </form>
      <p id="jobMsg"></p>
    </section>

    <section>
      <h2>My Jobs</h2>
      <div id="myJobs"></div>
    </section>
  </main>

  <script>
    async function loadMyJobs() {
      const res = await fetch("/api/hr/jobs/mine", { headers: authHeaders() });
      const jobs = await res.json();
      const container = document.getElementById("myJobs");
      container.innerHTML = "";
      jobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
          <h3>${job.title}</h3>
          <p>${job.description}</p>
          <small>Skills: ${job.skills}</small><br>
          <button onclick="deleteJob(${job.id})">Delete</button>
          <button onclick="viewApplications(${job.id})">View Applications</button>
          <div id="apps-${job.id}"></div>
        `;
        container.appendChild(div);
      });
    }

    async function deleteJob(id) {
      await fetch("/api/hr/jobs/" + id, { method: "DELETE", headers: authHeaders() });
      loadMyJobs();
    }

    async function viewApplications(id) {
      const res = await fetch(`/api/hr/jobs/${id}/applications`, { headers: authHeaders() });
      const apps = await res.json();
      const div = document.getElementById("apps-" + id);
      div.innerHTML = apps.map(a =>
        `<p>${a.candidateUsername} - ${a.status} 
        <button onclick="updateStatus(${a.id},'SHORTLISTED')">Shortlist</button>
        <button onclick="updateStatus(${a.id},'REJECTED')">Reject</button>
        <button onclick="updateStatus(${a.id},'HIRED')">Hire</button>
        </p>`).join("");
    }

    async function updateStatus(appId, status) {
      await fetch(`/api/hr/applications/${appId}/status?status=${status}`, {
        method: "POST",
        headers: authHeaders()
      });
      loadMyJobs();
    }

    document.getElementById("jobForm").addEventListener("submit", async e => {
      e.preventDefault();
      const job = {
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        skills: document.getElementById("skills").value
      };
      await fetch("/api/hr/jobs", {
        method: "POST",
        headers: authHeaders(),
        body: JSON.stringify(job)
      });
      document.getElementById("jobMsg").textContent = "Job posted!";
      loadMyJobs();
    });

    loadMyJobs();
  </script>
</body>
</html>
